# Topology
# --------------
#      xrd1
#     /    \
#  xrd2 -- xrd3

# Networks
# --------------
# host (172.28.0.1/16): xrd1 172.28.0.10, xrd2 172.28.0.20, xrd3 172.28.0.30
# xrd1-xrd2 (10.0.3.0/24):  10.0.3.1 - 10.0.3.2 (Gi0/0/0/1 - Gi0/0/0/0)
# xrd1-xrd3 (10.0.4.0/24):  10.0.4.1 - 10.0.4.3 (Gi0/0/0/6 - Gi0/0/0/6)
# xrd2-xrd3 (10.0.5.0/24):  10.0.5.2 - 10.0.5.3 (Gi0/0/0/1 - Gi0/0/0/1)

services:
  xrd1:
    container_name: xrd1
    xr_startup_cfg: xrd1_xrconf.cfg
    xr_interfaces:
      - Gi0/0/0/0
      - Gi0/0/0/1
      - Mg0/RP0/CPU0/0:
          snoop_v4: True
          snoop_v4_default_route: True
    networks:
      mgmt:
        ipv4_address: 10.10.20.101
  xrd2:
    container_name: xrd2
    xr_startup_cfg: xrd2_xrconf.cfg
    xr_interfaces:
      - Gi0/0/0/0
      - Gi0/0/0/2
      - Mg0/RP0/CPU0/0:
          snoop_v4: True
          snoop_v4_default_route: True
    networks:
      mgmt:
        ipv4_address: 10.10.20.102
  xrd3:
    container_name: xrd3
    xr_startup_cfg: xrd3_xrconf.cfg
    xr_interfaces:
      - Gi0/0/0/1
      - Gi0/0/0/2
      - Mg0/RP0/CPU0/0:
          snoop_v4: True
          snoop_v4_default_route: True
    networks:
      mgmt:
        ipv4_address: 10.10.20.103

xr_l2networks:
  - ["xrd1:Gi0/0/0/0", "xrd2:Gi0/0/0/0"]
  - ["xrd1:Gi0/0/0/1", "xrd3:Gi0/0/0/1"]
  - ["xrd2:Gi0/0/0/2", "xrd3:Gi0/0/0/2"]

networks:
  mgmt:
    xr_interfaces:
      - xrd1:Mg0/RP0/CPU0/0
      - xrd2:Mg0/RP0/CPU0/0
      - xrd3:Mg0/RP0/CPU0/0
    ipam:
      config:
        - subnet: 10.10.20.0/24
          gateway: 10.10.20.254
    driver: macvlan
    driver_opts:
      parent: ens192
