# Logging Quick Reference

## Enable Colors for Development

```bash
# Option 1: Export environment variable
export ENABLE_COLOR=1
make deploy-segment-routing

# Option 2: Create .env file
echo "ENABLE_COLOR=1" > .env
make deploy-segment-routing

# Option 3: Inline
ENABLE_COLOR=1 make deploy-segment-routing
```

## Disable Colors (Default)

```bash
# Colors are disabled by default for CI/CD compatibility
make deploy-segment-routing

# Or explicitly disable
export ENABLE_COLOR=0
make deploy-segment-routing
```

## View Logs

```bash
# List all log sessions
ls -la logs/

# View latest log session
ls -la logs/$(ls -t logs/ | head -1)/

# Tail a specific log file
tail -f logs/2025-12-18_14-30-45/segment-routing-deploy.log

# View all logs from a session
cat logs/2025-12-18_14-30-45/*.log
```

## Add Logging to a Script

```bash
#!/usr/bin/env bash

# 1. Source common utilities
source "$SCRIPT_DIR/../lib/common.sh"

# 2. Initialize logging
init_logging "my-script"

# 3. Use logging functions
log_exec "Running command..." command args
print_info "Information message"
log_message "[INFO] Information message"

# 4. Finalize before exit
finalize_logging
exit 0
```

## Log Directory Structure

```
XRd-Sandbox/
└── logs/
    ├── 2025-12-18_14-30-45/    # RUN_ID (timestamp)
    │   ├── script1.log
    │   └── script2.log
    └── 2025-12-18_15-42-10/
        └── script3.log
```

## Clean Up Old Logs

```bash
# Remove logs older than 7 days
find logs/ -type d -name "202*" -mtime +7 -exec rm -rf {} +

# Remove all logs
rm -rf logs/

# Keep only last 10 log sessions
ls -t logs/ | tail -n +11 | xargs -I {} rm -rf logs/{}
```

## Environment Variables

| Variable       | Default                | Description                               |
| -------------- | ---------------------- | ----------------------------------------- |
| `ENABLE_COLOR` | `0`                    | Enable/disable color output (1=on, 0=off) |
| `LOG_DIR`      | `${SANDBOX_ROOT}/logs` | Base directory for logs                   |
| `RUN_ID`       | Auto-generated         | Timestamp for current execution session   |

```text
Note: RUN_ID is automatically generated by the Makefile
```

## Logging Functions

| Function           | Usage                        | Description                     |
| ------------------ | ---------------------------- | ------------------------------- |
| `init_logging`     | `init_logging "script-name"` | Initialize logging for a script |
| `log_message`      | `log_message "text"`         | Write message to log file       |
| `log_exec`         | `log_exec "desc" cmd args`   | Execute command with logging    |
| `finalize_logging` | `finalize_logging`           | Close log file and show path    |

## Common Patterns

### Error Handling with Logging

```bash
if ! log_exec "Critical operation..." command args; then
    finalize_logging
    exit 1
fi
```

### Conditional Logging

```bash
if [[ -n "$CURRENT_LOG_FILE" ]]; then
    log_message "Custom log entry"
fi
```

### Multiple Commands

```bash
log_exec "Step 1..." command1
log_exec "Step 2..." command2
log_exec "Step 3..." command3
```

## CI/CD Examples

### GitHub Actions

```yaml
- name: Deploy
  run: make deploy-always-on
  env:
    ENABLE_COLOR: 0

- name: Upload Logs
  uses: actions/upload-artifact@v3
  if: always()
  with:
    name: deployment-logs
    path: logs/
```

### GitLab CI

```yaml
deploy:
  script:
    - make deploy-segment-routing
  artifacts:
    paths:
      - logs/
    when: always
  variables:
    ENABLE_COLOR: "0"
```
